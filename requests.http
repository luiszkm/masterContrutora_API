# requests.http

###
# @name As variáveis globais serão definidas dinamicamente pelas requisições.
@hostname = http://localhost:8080
@token =
@obraId =34631410-3a92-4f9e-9cd5-8fcd63ff0a74
@etapaId =f77558d9-a8ea-4706-bb18-f06eaaa57c01
@funcionarioId =f761b03c-ef47-4af4-93a7-271cd324431a

# ===================================================================
# [FLUXO 1] - AUTENTICAÇÃO
# ===================================================================

###
# @name Registrar
# 1. Registra um novo usuário no sistema.
POST {{hostname}}/usuarios/registrar
Content-Type: application/json

{
    "nome": "Usuário de Teste",
    "email": "teste@construtora.com",
    "senha": "senha_forte_123",
    "confirmarSenha": "senha_forte_123"
}

###
# @name Login
# 2. Faz o login para obter o token de acesso (JWT).
# O token retornado será capturado na variável global 'token'.
POST {{hostname}}/usuarios/login
Content-Type: application/json

{
    "email": "teste@construtora.com",
    "senha": "senha_forte_123"
}

> {%
    client.global.set("token", response.body.accessToken);
%}

###
# ===================================================================
# [FLUXO 2] - OBRAS (ROTAS PROTEGIDAS)
# Note o cabeçalho 'Authorization' em todas as requisições abaixo.
# ===================================================================

###
# @name CriarObra
# 3. Cria uma nova obra usando o token obtido.
# O ID da obra criada será capturado na variável 'obraId'.
POST {{hostname}}/obras
Content-Type: application/json

{
    "nome": "Residencial Dinâmico",
    "cliente": "Cliente Teste",
    "endereco": "Rua dos Testes, 101",
    "dataInicio": "2025-10-01"
}

> {%
    client.global.set("obraId", response.body.id);
%}


###
# @name BuscarDashboard
# 4. Busca o dashboard da obra que acabamos de criar.
# Note que a URL usa a variável {{obraId}} que foi capturada acima.
GET {{hostname}}/obras/{{obraId}}
Authorization: Bearer {{token}}

###
# @name ListarTodasAsObras
# Busca uma lista simplificada de todas as obras cadastradas.
GET {{hostname}}/obras

###
# ===================================================================
# [FLUXO 3] - ETAPAS (ROTAS PROTEGIDAS)
# ===================================================================

###
# @name AdicionarEtapa
# 5. Adiciona uma etapa à obra criada.
# O ID da etapa criada será capturado na variável 'etapaId'.
POST {{hostname}}/obras/{{obraId}}/etapas
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "nome": "Fundações e Alicerce",
    "dataInicioPrevista": "2025-10-05",
    "dataFimPrevista": "2025-10-30"
}

> {%
    client.global.set("etapaId", response.body.id);
%}

###
# @name MoverEtapaParaEmAndamento
# 6. Atualiza o status da etapa para "Em Andamento".
PATCH {{hostname}}/obras/{{obraId}}/etapas/{{etapaId}}
Content-Type: application/json

{
    "status": "Em Andamento"
}

###
# @name AtualizarStatusEtapa
# 6. Atualiza o status da etapa que acabamos de criar.
# A URL usa tanto {{obraId}} quanto {{etapaId}}.
PATCH {{hostname}}/obras/{{obraId}}/etapas/{{etapaId}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "status": "Concluída"
}

###
# @name VerificarProgresso
# 7. Busca o dashboard novamente para ver o progresso atualizado.
# O "percentualConcluido" agora deve ser 100.
GET {{hostname}}/obras/{{obraId}}
Authorization: Bearer {{token}}



###
# ===================================================================
# [FLUXO 3] - PESSOAL E ALOCAÇÕES
# ===================================================================

###
# @name CadastrarFuncionario
# 5. Cadastra um novo funcionário para poder alocá-lo.
# O ID do funcionário será capturado na variável 'funcionarioId'.
POST {{hostname}}/funcionarios
Content-Type: application/json

{
    "nome": "João da Silva",
    "cpf": "111.222.333-44",
    "cargo": "Engenheiro Civil",
    "salario": 9500.00,
    "diaria": 75.00
}

> {%
    client.global.set("funcionarioId", response.body.ID);
%}


###
# @name AlocarFuncionario
# 6. Aloca o funcionário que acabamos de criar na nossa obra.
# A URL usa {{obraId}} e o corpo usa {{funcionarioId}}.
POST {{hostname}}/obras/{{obraId}}/alocacoes
Content-Type: application/json

{
    "funcionarioId": "{{funcionarioId}}",
    "dataInicioAlocacao": "2025-07-05"
}

###
# @name VerificarDashboardCompleto
# 7. Busca o dashboard novamente.
# O campo 'funcionariosAlocados' agora deve ser 1.
GET {{hostname}}/obras/{{obraId}}

###
# ===================================================================
# [FLUXO 4] - SUPRIMENTOS / MATERIAIS (ROTAS PROTEGIDAS)
# ===================================================================

###
# @name CadastrarMaterial
# 1. Cadastra um novo material no sistema.
# O ID do material criado será capturado na variável 'materialId'.
POST {{hostname}}/materiais
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "nome": "Cimento Portland CP II 50kg",
    "descricao": "Cimento para uso geral em concretos e argamassas.",
    "unidadeDeMedida": "un",
    "categoria": "Estrutural"
}

> {%
    client.global.set("materialId", response.body.ID);
%}

###
# @name CadastrarOutroMaterial
# 2. Cadastra outro material para termos uma lista.
POST {{hostname}}/materiais
Content-Type: application/json
Authorization: Bearer {{token}}

{
    "nome": "Vergalhão de Aço CA-50 10mm",
    "descricao": "Barra de aço para armaduras de concreto.",
    "unidadeDeMedida": "barra",
    "categoria": "Estrutural"
}


###
# @name ListarMateriais
# 3. Lista todos os materiais cadastrados no sistema.
GET {{hostname}}/materiais
Authorization: Bearer {{token}}
###
# ===================================================================
# [FLUXO 5] - SUPRIMENTOS / FORNECEDORES (ROTAS PROTEGIDAS)
# ===================================================================

###
# @name CadastrarFornecedor
# 1. Cadastra um novo fornecedor de materiais de construção.
# Lembre-se de ter um cookie válido na variável 'token_cookie'.
# O ID será capturado na variável 'fornecedorId'.
POST {{hostname}}/fornecedores
Content-Type: application/json

{
    "nome": "Casa do Construtor Center",
    "cnpj": "12.345.678/0001-99",
    "categoria": "Materiais Básicos",
    "contato": "Carlos Andrade",
    "email": "comercial@casadoconstrutor.com"
}

> {%
    client.global.set("fornecedorId", response.body.ID);
%}

###
# @name CadastrarOutroFornecedor
# 2. Cadastra um segundo fornecedor para popular nossa lista.
POST {{hostname}}/fornecedores
Content-Type: application/json

{
    "nome": "Elétrica Total Ltda",
    "cnpj": "98.765.432/0001-11",
    "categoria": "Materiais Elétricos",
    "contato": "Mariana Lima",
    "email": "vendas@eletricatotal.com"
}


###
# @name ListarFornecedores
# 3. Lista todos os fornecedores cadastrados no sistema.
GET {{hostname}}/fornecedores

